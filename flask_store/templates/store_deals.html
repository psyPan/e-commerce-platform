{% extends "index.html" %}

{% block title %}Deals & Discounts - {{ store.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="bg-gradient-to-r from-red-600 to-pink-600 rounded-lg shadow-lg p-8 mb-8 text-white">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-4xl font-bold mb-2">
                    <i class="fas fa-tags mr-2"></i> Hot Deals & Discounts
                </h1>
                <p class="text-xl">Special offers from {{ store.name }}</p>
            </div>
            <div class="text-right">
                <a href="{{ url_for('stores.view_store', store_id=store.store_id) }}" 
                   class="bg-white text-red-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition inline-block">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Store
                </a>
            </div>
        </div>
    </div>

    {% if products %}
    <!-- Deals Count -->
    <div class="mb-6">
        <p class="text-gray-700 text-lg">
            <strong>{{ products|length }}</strong> product{% if products|length != 1 %}s{% endif %} on sale
        </p>
    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
        {% for product in products %}
        <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition relative">
            <!-- Discount Badge -->
            {% if product.discount and product.discount > 0 %}
            <div class="absolute top-2 right-2 z-10">
                <span class="bg-red-600 text-white px-3 py-2 rounded-full font-bold text-sm shadow-lg">
                    -{{ product.discount }}% OFF
                </span>
            </div>
            {% endif %}

            <a href="{{ url_for('stores.product_detail', store_id=store.store_id, product_id=product.product_id) }}">
                <div class="h-48 bg-gray-200 flex items-center justify-center">
                    {% if product.image %}
                    <img src="{{ product.image }}" alt="{{ product.name }}" class="h-full w-full object-cover">
                    {% else %}
                    <i class="fas fa-box text-6xl text-gray-400"></i>
                    {% endif %}
                </div>
            </a>
            
            <div class="p-4">
                <h3 class="font-bold text-lg mb-2 truncate">
                    <a href="{{ url_for('stores.product_detail', store_id=store.store_id, product_id=product.product_id) }}" 
                       class="text-gray-800 hover:text-blue-600">
                        {{ product.name }}
                    </a>
                </h3>
                
                <p class="text-sm text-gray-600 mb-3">{{ product.manufacturer or 'Unknown' }}</p>
                
                <!-- Price Section -->
                <div class="mb-3">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-gray-500 line-through text-sm">${{ "%.2f"|format(product.sell_price) }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-red-600 font-bold text-2xl">${{ "%.2f"|format(product.get_final_price()) }}</span>
                        <span class="text-green-600 font-semibold text-sm">
                            Save ${{ "%.2f"|format(product.sell_price - product.get_final_price()) }}
                        </span>
                    </div>
                </div>
                
                <!-- Stock Status -->
                <div class="flex items-center justify-between pt-3 border-t">
                    {% if product.stock > 0 %}
                    <span class="text-green-600 text-sm font-semibold">
                        <i class="fas fa-check-circle"></i> {{ product.stock }} in stock
                    </span>
                    {% else %}
                    <span class="text-red-600 text-sm font-semibold">
                        <i class="fas fa-times-circle"></i> Out of Stock
                    </span>
                    {% endif %}
                    
                    <a href="{{ url_for('stores.product_detail', store_id=store.store_id, product_id=product.product_id) }}" 
                       class="text-blue-600 hover:text-blue-700 text-sm font-semibold">
                        View Details <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Call to Action -->
    <div class="mt-12 bg-blue-50 rounded-lg p-8 text-center">
        <h2 class="text-2xl font-bold text-gray-800 mb-3">
            <i class="fas fa-bell mr-2"></i> Don't Miss Out!
        </h2>
        <p class="text-gray-600 mb-4">
            These deals won't last forever. Check back regularly for new discounts and special offers.
        </p>
        <a href="{{ url_for('stores.view_store', store_id=store.store_id) }}" 
           class="inline-block bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
            Browse All Products
        </a>
    </div>

    {% else %}
    <!-- No Deals Available -->
    <div class="bg-white rounded-lg shadow-md p-12 text-center">
        <i class="fas fa-tags text-6xl text-gray-400 mb-4"></i>
        <h3 class="text-2xl font-bold text-gray-700 mb-2">No Deals Available Right Now</h3>
        <p class="text-gray-600 mb-6">
            This store doesn't have any discounted products at the moment, but check back soon for special offers!
        </p>
        <a href="{{ url_for('stores.view_store', store_id=store.store_id) }}" 
           class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-semibold">
            <i class="fas fa-arrow-left mr-2"></i> Browse All Products
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}