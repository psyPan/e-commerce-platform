{% extends "index.html" %}

{% block navbar %}
<div class="navbar">
    <div class="logo">
        <a href="{{ url_for('users.home') }}">Our Logo</a>
    </div>
    <div class="nav-links">
        <a href="{{ url_for('users.home') }}">Home</a>
        <a href="{{ url_for('users.logout') }}">Log Out</a>
    </div>
</div>
{% endblock navbar %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='style/home.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='style/my_cart.css') }}">

<div class="cart-wrapper">

    <div class="cart-title">My Cart</div>

    <!-- HEADER -->
    <div class="cart-header">
        <div class="col-check">
            <input type="checkbox" id="select-all">
        </div>        
        <div class="col-product">Select All</div>
        <div class="col-price">Unit Price</div>
        <div class="col-qty">Quantity</div>
        <div class="col-total">Total</div>
        <div class="col-action"></div>
    </div>

    <!-- ITEM -->
    <div class="cart-item" data-price="150">
        <div class="col-check">
            <input type="checkbox" class="item-checkbox">
        </div>        
        <div class="col-product product-info">
            <div class="product-img">Image</div>
            <div class="product-name">Product Name</div>
        </div>

        <div class="col-price">$150</div>

        <div class="col-qty qty-box">
            <button>-</button>
            <input type="text" value="0">
            <button>+</button>
        </div>

        <div class="col-total">$150</div>

        <div class="col-action">
            <button class="delete-btn">✕</button>
        </div>
    </div>

    <div class="cart-item" data-price="100">
        <div class="col-check">
            <input type="checkbox" class="item-checkbox">
        </div>        

        <div class="col-product product-info">
            <div class="product-img">Image</div>
            <div class="product-name">Product Name</div>
        </div>

        <div class="col-price">$100</div>

        <div class="col-qty qty-box">
            <button>-</button>
            <input type="text" value="0">
            <button>+</button>
        </div>

        <div class="col-total">$200</div>

        <div class="col-action">
            <button class="delete-btn">✕</button>
        </div>
    </div>

    <!-- SUBTOTAL -->
    <div class="cart-subtotal">
        <div></div> <!-- checkbox kosong -->
        <div>Subtotal</div>
        <div></div> <!-- unit price kosong -->
        <div style="text-align:center;" id="subtotal-items">7 items</div>
        <div style="text-align:center;" id="subtotal-price">$950</div>
        <div></div> <!-- delete kosong -->
    </div>    

    <!-- BOTTOM SECTION -->
    <div class="cart-bottom">

        <div class="receiver-card">
            <h3>Receiver’s Information</h3>
        
            <div class="receiver-row">
                <span>First name</span>
                <p>John</p>
            </div>
        
            <div class="receiver-row">
                <span>Last name</span>
                <p>Doe</p>
            </div>
        
            <div class="receiver-row">
                <span>Phone</span>
                <p>0912345678</p>
            </div>
        
            <div class="receiver-row">
                <span>Address</span>
                <p>Taipei</p>
            </div>
        </div>
        

        <div class="summary-card">
            <h3>Summary</h3>
        
            <div class="summary-row">
                <span>Subtotal</span>
                <span id="summary-subtotal">$350</span>
            </div>
        
            <div class="summary-row">
                <span>Discount</span>
                <span id="summary-discount">-$0</span>
            </div>
        
            <div class="summary-row">
                <span>Shipping</span>
                <span id="summary-shipping">$0</span>
            </div>
        
            <div class="summary-row total">
                <span>Total</span>
                <span id="summary-total">$350</span>
            </div>
        </div>
        

    </div>

    <div class="checkout-area">
        <button class="checkout-btn">Check Out</button>
    </div>

    <script>
        function updateCart() {
            let items = document.querySelectorAll(".cart-item");
            let totalQty = 0;
            let totalPrice = 0;
        
            items.forEach(item => {
                const checkbox = item.querySelector(".item-checkbox");
                const price = parseInt(item.dataset.price);
                const qtyInput = item.querySelector(".qty-box input");
                const qty = parseInt(qtyInput.value);

                if (!checkbox || checkbox.checked) {
                    const itemTotal = price * qty;
                    item.querySelector(".col-total").innerText = `$${itemTotal}`;

                    totalQty += qty;
                    totalPrice += itemTotal;
                }
            });

        
            document.getElementById("subtotal-items").innerText =
                `${totalQty} item${totalQty > 1 ? "s" : ""}`;
        
            document.getElementById("subtotal-price").innerText = `$${totalPrice}`;
            document.getElementById("summary-total").innerText = `$${totalPrice}`;
        }
        
        /* PLUS / MINUS BUTTON */
        document.querySelectorAll(".qty-box").forEach(box => {
            const input = box.querySelector("input");
            const minus = box.querySelector("button:first-child");
            const plus = box.querySelector("button:last-child");
        
            minus.onclick = () => {
                let val = parseInt(input.value);
                if (val > 1) {
                    input.value = val - 1;
                    updateCart();
                }
            };
        
            plus.onclick = () => {
                input.value = parseInt(input.value) + 1;
                updateCart();
            };
        
            input.onchange = updateCart;
        });
        
        /* DELETE ITEM */
        document.querySelectorAll(".delete-btn").forEach(btn => {
            btn.onclick = () => {
                btn.closest(".cart-item").remove();
                updateCart();
            };
        });
        
        /* INIT */
        updateCart();
        </script>        

<script>
    /* =========================
       SELECT ALL CHECKBOX
    ========================= */
    const selectAll = document.getElementById("select-all");
    
    function syncSelectAll() {
        const items = document.querySelectorAll(".item-checkbox");
        const checkedItems = document.querySelectorAll(".item-checkbox:checked");
    
        selectAll.checked = items.length === checkedItems.length && items.length > 0;
    }
    
    selectAll.addEventListener("change", () => {
        document.querySelectorAll(".item-checkbox").forEach(cb => {
            cb.checked = selectAll.checked;
        });
    });
    
    /* item checkbox change */
    document.addEventListener("change", (e) => {
        if (e.target.classList.contains("item-checkbox")) {
            syncSelectAll();
        }
    });
    </script>
    

</div>
{% endblock %}
