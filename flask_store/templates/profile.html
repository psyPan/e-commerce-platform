{% extends "index.html" %}

{% block navbar %}
<div class="navbar">
    <div class="logo">
        <a href="{{ url_for('users.home') }}">Our Logo</a>
    </div>
    <div class="nav-links">
        <a href="{{ url_for('users.profile') }}">My Profile</a>
        <a href="{{ url_for('users.logout') }}">Log Out</a>
    </div>
</div>
{% endblock navbar %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='style/home.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='style/profile.css') }}">

<div class="profile-wrapper">

    <!-- SIDE MENU -->
    <div class="profile-sidebar">
        <a class="side-btn active">My Profile</a>
        <a class="side-btn" href="{{ url_for('users.credit') }}">My Credit Card</a>
        <a class="side-btn" href="{{ url_for('users.change_password') }}">Change Password</a>
        <a class="side-btn" href="{{ url_for('users.order_history') }}">Order History</a>
        <a class="side-btn" href="{{ url_for('users.my_cart') }}">My Cart</a>
    </div>

    <!-- MAIN CONTENT -->
    <div class="profile-content">

        <div class="profile-card" id="profileBox">
            <h1 class="profile-title">My Profile</h1>

            <!-- ================= VIEW MODE ================= -->
            <div class="profile-view">

                <div class="profile-row">
                    <span>Full Name</span>
                    <p>{{ current_user.f_name }} {{ current_user.l_name }}</p>
                </div>

                <div class="profile-row">
                    <span>Birth Date</span>
                    <p>{{ current_user.birth }}</p>
                </div>

                <div class="profile-row">
                    <span>Phone</span>
                    <p>{{ current_user.phone }}</p>
                </div>

                <div class="profile-row">
                    <span>Address</span>
                    <p>{{ current_user.address }}</p>
                </div>

                <div class="profile-row">
                    <span>Email</span>
                    <p>{{ current_user.email }}</p>
                </div>

            </div>

            <!-- ================= EDIT BUTTON (KANAN BAWAH) ================= -->
            <div class="profile-actions profile-actions-view">
                <button type="button" class="edit-btn" onclick="enterEdit()">Edit Profile</button>
            </div>

            <!-- ================= EDIT MODE ================= -->
            <form method="POST" class="profile-form" action="{{ url_for('users.update_profile') }}">
                {{ form.hidden_tag() }}

                <div class="profile-form-row two-col">
                    <!-- First Name Field -->
                    <div class="form-group">
                        {{ form.f_name.label(class="form-label") }}
                        {% if form.f_name.errors %}
                            {{ form.f_name(class="form-input is-invalid", placeholder="John") }}
                            <div class="invalid-feedback">
                                {% for error in form.f_name.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.f_name(class="profile-input") }}
                        {% endif %}
                    </div>
                
                    <div class="form-group">
                        {{ form.l_name.label(class="form-label") }}
                        {% if form.l_name.errors %}
                            {{ form.l_name(class="form-input is-invalid", placeholder="John") }}
                            <div class="invalid-feedback">
                                {% for error in form.l_name.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.l_name(class="profile-input") }}
                        {% endif %}
                    </div>
                </div>

                <div class="profile-form-row two-col">
                    <div class="form-group">
                        {{ form.email.label(class="form-label") }}
                        {% if form.email.errors %}
                            {{ form.email(class="form-input is-invalid", placeholder="John") }}
                            <div class="invalid-feedback">
                                {% for error in form.email.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.email(class="profile-input") }}
                        {% endif %}
                    </div>
                
                    <div class="form-group">
                        {{ form.phone.label(class="form-label") }}
                        {% if form.phone.errors %}
                            {{ form.phone(class="form-input is-invalid", placeholder="John") }}
                            <div class="invalid-feedback">
                                {% for error in form.phone.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.phone(class="profile-input") }}
                        {% endif %}
                    </div>
                </div>

                <div class="profile-form-row two-col">
                    <div class="form-group">
                        {{ form.birth.label(class="form-label") }}
                        {% if form.birth.errors %}
                            {{ form.birth(class="form-input is-invalid", placeholder="John") }}
                            <div class="invalid-feedback">
                                {% for error in form.birth.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.birth(class="profile-input") }}
                        {% endif %}
                    </div>
                
                    <div class="form-group">
                        {{ form.address.label(class="form-label") }}
                        {% if form.address.errors %}
                            {{ form.address(class="form-input is-invalid", placeholder="John") }}
                            <div class="invalid-feedback">
                                {% for error in form.address.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.address(class="profile-input") }}
                        {% endif %}
                    </div>
                </div>

                <div class="profile-actions profile-actions-form">
                    <button type="button" class="cancel-btn" onclick="exitEdit()">
                        Cancel
                    </button>
                    <button type="submit" class="btn-gold">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function enterEdit() {
    document.getElementById("profileBox").classList.add("editing");
}

function exitEdit() {
    document.getElementById("profileBox").classList.remove("editing");
}
// If success, exit edit mode automatically
document.addEventListener('DOMContentLoaded', function() {
    const flashMessages = document.querySelectorAll('.alert-success');
    if (flashMessages.length > 0) {
        // Form was successfully submitted, stay in view mode
        exitEdit();
    }
});
</script>
{% endblock %}
